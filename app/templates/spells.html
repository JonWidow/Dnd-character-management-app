{% extends "base.html" %}

{% block title %}Search{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto p-6">
    <h2 class="text-2xl font-bold mb-4 text-blue-800">Search</h2>

    <input type="text" id="search-bar" placeholder="Search spells..."
        class="w-full sm:w-80 border rounded p-2 mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500">

    <div id="results" class="space-y-2"></div>

    <script>
        const searchBar = document.getElementById('search-bar');
        const resultsDiv = document.getElementById('results');
        let timeout = null;

        searchBar.addEventListener('input', () => {
            clearTimeout(timeout);
            timeout = setTimeout(async () => {
                const q = searchBar.value.trim();
                const res = await fetch(`/api/spells?q=${encodeURIComponent(q)}`);
                const spells = await res.json();

                resultsDiv.innerHTML = spells.map(s => `
                    <div class="spell rounded shadow p-4 hover:bg-gray-100 transition" style="background-color: #fafbfc;">
                        <a href="/spells/${s.id}" target="_blank" class="block">
                            <strong class="text-blue-800 text-lg">${s.name}</strong>
                            <span class="text-sm text-gray-600"> (Level ${s.level}, ${s.school})</span><br>
                            <span class="text-sm text-gray-700">?? ${s.casting_time}</span>
                        </a>
                    </div>
                `).join('');

            }, 300);
        });
    </script>
</div>
{% endblock %}
