{% extends "base.html" %}
{% block title %}Characters{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto px-6 py-8">
    <div class="mb-8">
        <h1 class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-blue-800">Characters</h1>
        <p class="text-gray-600 mt-2">Search and manage your D&D characters</p>
    </div>

    <div class="mb-6">
        <div class="relative">
            <i class="fas fa-search absolute left-4 top-3 text-gray-400"></i>
            <input type="text" id="search-bar" placeholder="Search characters by name, class, or level..." 
                   class="w-full pl-12 pr-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition">
        </div>
    </div>

    <div id="results" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
</div>

<script>
const searchBar = document.getElementById('search-bar');
const resultsDiv = document.getElementById('results');
let timeout = null;

// Fetch all characters initially
async function fetchCharacters(query='') {
    const res = await fetch(`/api/characters?q=${encodeURIComponent(query)}`);
    const characters = await res.json();

    if (characters.length === 0) {
        resultsDiv.innerHTML = `
            <div class="col-span-full text-center py-12">
                <i class="fas fa-search text-4xl text-gray-300 mb-4"></i>
                <p class="text-gray-500 text-lg">No characters found</p>
            </div>
        `;
        return;
    }

    resultsDiv.innerHTML = characters.map(c => `
        <a href="/characters/${c.id}" class="bg-white rounded-lg shadow-md hover:shadow-lg transition overflow-hidden border-l-4 border-blue-600">
            <div class="p-6">
                <div class="flex items-start justify-between mb-3">
                    <h3 class="text-xl font-bold text-gray-800">${c.name}</h3>
                    <span class="inline-block bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-semibold">Level ${c.level}</span>
                </div>
                <div class="space-y-2 text-sm text-gray-600">
                    <p><i class="fas fa-book text-blue-600 mr-2 w-5"></i><span class="font-medium">${c.char_class}</span></p>
                    <p class="text-gray-500">Click to view details</p>
                </div>
            </div>
        </a>
    `).join('');
}

// Initial load
fetchCharacters();

// Search handler
searchBar.addEventListener('input', () => {
    clearTimeout(timeout);
    timeout = setTimeout(() => {
        fetchCharacters(searchBar.value.trim());
    }, 300);
});
</script>
{% endblock %}
